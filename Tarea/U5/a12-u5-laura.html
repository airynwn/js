<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h2>
      12. Valida el siguiente formulario. Valide también que no puedan dejarse
      en blanco. Validar el formulario ayudándote de los atributos de html5. La
      validación se debe realizar poco a poco según el usuario vaya rellenando
      los campos. En caso de introducir un valor incorrecto, limpiar el campo.
    </h2>

    <form action="">
        <label for="dni">DNI: </label>
        <input type="text" name="dni"
        pattern="^\d{2}\.\d{3}.\d{3}-[A-Z]$" id="dni" required>
        <!-- 99.999.999-X -->
        <br>
        <label for="nombre">Nombre: </label>
        <input type="text" name="nombre"
        pattern="^([A-Z][a-z]*\s[A-Z][a-z]*){1,2}$" id="nombre" required>
        <!-- min: 1 nombre 1 apellido; max: 2 nombres 2 apellidos -->
        <br>
        <label for="fnac">Fecha de nacimiento: </label>
        <input type="date" name="fnac" id="fnac"
        pattern="^\d{2}\/\d{2}\/\d{4}$" required>
        <!-- dd mm yyyy -->
        <br>
        <label for="email">Email: </label>
        <input type="email" name="email" id="email"
        pattern="^\w*@[a-z]*\.[a-z]*$" required>
        <!-- xxx@yyy.zzz -->
        <br>
        <label for="web">Página web: </label>
        <input type="text" name="web" id="web"
        pattern="^http\:\/\/www\.[a-z]*\.[a-z]*$" required>
        <!-- http://www.xxx.yyy -->
        <br>
        <label for="pw">Contraseña: </label>
        <input type="password" name="pw" id="pw"
        pattern="^\w{8,10}$" required>
        <!-- 8 ~ 10 caracteres -->
        <br>
        <label for="pw2">Confirmar contraseña: </label>
        <input type="password" name="pw2" id="pw2"
        pattern="^\w{8,10}$" required>
        <!-- 8 ~ 10 caracteres -->
        <br>
        <input type="submit" id="enviar" value="Guardar">
        <input type="button" id="ver" value="Ver">
        
    </form>
    <script type="text/javascript">

    function validarCampo(campo, errorVacio, errorPatron) {
      // Interrumpir validación
      campo.addEventListener("input", () => {
        campo.setCustomValidity("");
        campo.checkValidity();
      });

      // Si no es válido:
      campo.addEventListener("invalid", () => {
        if (campo.validity.valueMissing) {
          campo.setCustomValidity(errorVacio);
        }
        
        if (campo.validity.patternMismatch) {
          campo.setCustomValidity(errorPatron);

        // Borrar cuando esté fuera de focus si es inválido
        campo.addEventListener("focusout", () => {
          if (campo.validity.valueMissing || campo.validity.patternMismatch) {
            campo.value = "";
          }
        });
        }
      });
    }
    
    var dni = document.getElementsByTagName("input")[0];
    validarCampo(dni, "Debes introducir un DNI", "Formato válido: 99.999.999-X");
    var nombre = document.getElementsByTagName("input")[1];
    validarCampo(nombre,
    "Introduzca al menos un nombre y un apellido. Máx: 2 nombres y 2 apellidos",
    "Los nombres y apellidos deben comenzar por mayúscula, tener al menos dos letras y estar separados por espacios.");
    // ! Mejorar validación de fecha (los años se pasan)
    var fecha = document.getElementsByTagName("input")[2];
    validarCampo(fecha, "Debes introducir una fecha de nacimiento.", "Formato válido: dd/mm/yyyy");
    var email = document.getElementsByTagName("input")[3];
    validarCampo(email, "Debes introducir un email.", "Formato válido: xxx@yyy.zzz");
    // ! No funciona la validación de web
    var web = document.getElementsByTagName("input")[4];
    validarCampo(web, "Debes introducir una página web.", "Formato válido: http://www.xxx.yyy");
    var pw1 = document.getElementsByTagName("input")[5];
    validarCampo(pw1, "Debes introducir una contraseña.", "Debe contener entre 8 y 10 caracteres");
    var pw2 = document.getElementsByTagName("input")[6];
    validarCampo(pw2, "Debes introducir una contraseña.", "Debe contener entre 8 y 10 caracteres");

    // Crear cookies de los datos introducidos
    enviar = document.getElementById("enviar");
    enviar.addEventListener("click", (e) => {
      var campos = [dni, nombre, fecha, email, web, pw1, pw2];
  
      function crearCookie(campo, valor) {
        document.cookie = campo + "=" + valor;
      }

      // Crea una cookie nombredelcampo=valor por cada campo al darle al botón
      for (campo of campos) {
        crearCookie(campo.getAttribute("name"), campo.value);
      }
    });

    // Mostrar las cookies
      ver = document.getElementById("ver");
      ver.addEventListener("click", () => {
        var datos = decodeURIComponent(document.cookie);
        alert(datos);
      });

  
    </script>
  </body>
</html>
